<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vansima Digital Journal ‚Äî All Styles Deluxe</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#111;
    --surface:#1f1f1f;
    --text:#fff;
    --accent:#ffcc00;
    --transition:300ms;
    --radius:12px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
    transition:background var(--transition), color var(--transition);
    padding:24px;
  }
  header{display:flex;gap:20px;align-items:center;justify-content:space-between;margin-bottom:18px}
  h1{margin:0;font-size:20px;font-weight:700;font-family:'Poppins',Inter,Arial;}
  .controls{
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .panel{
    background:var(--surface);
    padding:14px;
    border-radius:var(--radius);
    box-shadow:0 6px 18px rgba(0,0,0,0.4);
    transition:transform var(--transition), box-shadow var(--transition);
  }
  .panel:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(0,0,0,0.55)}
  .settings{display:grid;grid-template-columns:1fr;gap:12px;max-width:420px}
  label{display:flex;flex-direction:column;font-size:13px;gap:6px;color:rgba(255,255,255,0.9)}
  input[type="color"]{width:56px;height:36px;border-radius:8px;border:none;padding:0;margin:0;cursor:pointer}
  select, input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  .themes-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:340px}
  .theme-btn{height:56px;border-radius:10px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600;box-shadow:inset 0 -20px rgba(0,0,0,0.15);transition:transform 160ms}
  .theme-btn:active{transform:scale(0.98)}
  .preview{width:320px;padding:14px;border-radius:10px;min-height:160px;position:relative;overflow:hidden}
  .preview h3{margin:0;font-size:16px}
  .preview .meta{font-size:12px;opacity:0.85;margin-top:8px}
  .controls-row{display:flex;gap:10px;align-items:center}
  .accent-swatch{width:36px;height:36px;border-radius:8px;border:2px solid rgba(255,255,255,0.06)}
  .big{padding:20px}
  .grid-main{display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start}
  .journal{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);min-height:480px;overflow:auto}
  .section{background:rgba(0,0,0,0.12);padding:12px;border-radius:10px;margin-bottom:12px;transition:background var(--transition), transform var(--transition)}
  textarea{width:100%;min-height:80px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);padding:10px;background:transparent;color:inherit;resize:vertical}
  .tracker{display:flex;gap:8px;margin-top:8px}
  .tracker button{width:44px;height:44px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);cursor:pointer;font-size:18px;transition:transform 160ms, box-shadow 160ms}
  .tracker button.selected{box-shadow:0 6px 18px var(--accent);transform:translateY(-4px);background:linear-gradient(180deg, rgba(255,255,255,0.03), transparent)}
  .actions{display:flex;gap:8px;align-items:center;margin-top:8px}
  button.primary{background:var(--accent);color:#000;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 10px;border-radius:8px;cursor:pointer}
  .saved-themes{display:flex;gap:8px;flex-wrap:wrap;max-width:340px;margin-top:8px}
  .saved-theme{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;font-size:13px}
  .footer{margin-top:18px;font-size:13px;opacity:0.85}
  /* Gradient animation helper */
  .animated-bg{background-size:400% 400%;animation:grad 10s ease infinite}
  @keyframes grad{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }
  /* Responsive */
  @media (max-width:980px){
    .grid-main{grid-template-columns:1fr;gap:14px}
    .themes-grid{grid-template-columns:repeat(3,1fr);width:100%}
    .preview{width:100%}
  }
</style>
</head>
<body>
<header>
  <h1>‚ÄúPeace, Purpose & Progress - Be Great Todayüí´"</h1>
  <div class="controls">
    <div class="panel settings">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
        <strong>Customize</strong>
        <div style="font-size:12px;opacity:0.85">Save themes locally</div>
      </div>
      <label>Background <span style="font-size:12px;opacity:0.7"> (solid or gradient)</span>
        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <input id="bg-color" type="color" title="Background color">
          <input id="bg-color-2" type="color" title="Gradient second color">
          <label style="display:flex;align-items:center;gap:6px;margin-left:6px"><input id="use-gradient" type="checkbox"> Gradient</label>
        </div>
      </label>
      <label>Text Color
        <input id="text-color" type="color">
      </label>
      <label>Accent Color
        <input id="accent-color" type="color">
      </label>
      <label>Font
        <select id="font-select">
          <option value="Inter, Arial, sans-serif">Inter (Modern)</option>
          <option value="'Poppins', Inter, Arial, sans-serif">Poppins (Friendly)</option>
          <option value="'Playfair Display', serif">Playfair Display (Elegant)</option>
          <option value="'Courier New', monospace">Courier New (Typewriter)</option>
          <option value="'Georgia', serif">Georgia (Classic)</option>
        </select>
      </label>
      <label>Theme Name (for saving)
        <input id="theme-name" type="text" placeholder="e.g. Sunset Glow">
      </label>
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="save-theme" class="primary">Save My Theme</button>
        <button id="reset-theme" class="ghost">Reset</button>
      </div>
    </div>
  </div>
</header>

<main class="grid-main">
  <section class="journal panel">
    <div class="big">
      <div class="section">
        <h2>Morning Reflection</h2>
        <textarea id="morning"></textarea>
      </div>
      <div class="section">
        <h2>Today's Goals</h2>
        <textarea id="goals"></textarea>
      </div>
      <div class="section">
        <h2>Gratitude Tracker</h2>
        <textarea id="gratitude"></textarea>
      </div>
      <div class="section">
        <h2>Mood Tracker</h2>
        <div class="tracker" id="mood-tracker">
          <button data-mood="üòÉ">üòÉ</button>
          <button data-mood="üòä">üòä</button>
          <button data-mood="üòê">üòê</button>
          <button data-mood="üòî">üòî</button>
          <button data-mood="üò°">üò°</button>
        </div>
      </div>
      <div class="section">
        <h2>Habit Tracker</h2>
        <div class="habit-item"><input type="checkbox" id="habit1"><label for="habit1">Drink Water</label></div>
        <div class="habit-item"><input type="checkbox" id="habit2"><label for="habit2">Exercise</label></div>
        <div class="habit-item"><input type="checkbox" id="habit3"><label for="habit3">Read</label></div>
      </div>
      <div class="actions">
        <button id="download-btn" class="primary">Download Snapshot</button>
        <button id="export-theme" class="ghost">Export Theme JSON</button>
        <button id="import-theme" class="ghost">Import Theme</button>
      </div>
    </div>
  </section>

  <aside style="display:flex;flex-direction:column;gap:12px;align-items:flex-end">
    <div class="panel" style="width:360px">
      <strong>Theme Presets ‚Äî grouped</strong>
      <div style="margin-top:8px;font-size:13px;opacity:0.85">Pick from grouped styles or tweak them.</div>
      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
        <!-- Fun & Colorful -->
        <button class="theme-btn" data-theme='{"name":"Candy Pop","bg":"#ffd7f2","bg2":"#ffd7a8","gradient":true,"text":"#2c2c2c","accent":"#ff4db2","font":"Poppins, Inter, Arial, sans-serif","animated":true}' style="background:linear-gradient(135deg,#ffd7f2,#ffd7a8)">Candy Pop</button>
        <button class="theme-btn" data-theme='{"name":"Sunset Glow","bg":"#ff9a9e","bg2":"#fad0c4","gradient":true,"text":"#21120a","accent":"#ff6a00","font":"Inter, Arial, sans-serif","animated":true}' style="background:linear-gradient(135deg,#ff9a9e,#fad0c4)">Sunset Glow</button>
        <button class="theme-btn" data-theme='{"name":"Tropical Vibe","bg":"#a8ff78","bg2":"#78ffd6","gradient":true,"text":"#05201a","accent":"#00b894","font":"Poppins, Inter, Arial, sans-serif","animated":true}' style="background:linear-gradient(135deg,#a8ff78,#78ffd6)">Tropical</button>
        <!-- Modern & Minimal -->
        <button class="theme-btn" data-theme='{"name":"Cloud Gray","bg":"#f6f7fb","bg2":"#eef1f6","gradient":true,"text":"#111827","accent":"#4b5563","font":"Inter, Arial, sans-serif","animated":false}' style="background:linear-gradient(135deg,#f6f7fb,#eef1f6);color:#111827">Cloud Gray</button>
        <button class="theme-btn" data-theme='{"name":"Midnight Focus","bg":"#0b1226","bg2":"#121827","gradient":true,"text":"#e6eef8","accent":"#6ee7b7","font":"Inter, Arial, sans-serif","animated":false}' style="background:linear-gradient(135deg,#0b1226,#121827)">Midnight</button>
        <button class="theme-btn" data-theme='{"name":"Frost White","bg":"#ffffff","bg2":"#f8fafc","gradient":true,"text":"#0b1226","accent":"#2563eb","font":"Inter, Arial, sans-serif","animated":false}' style="background:linear-gradient(135deg,#ffffff,#f8fafc);color:#0b1226">Frost</button>
        <!-- Soft & Aesthetic -->
        <button class="theme-btn" data-theme='{"name":"Blush Dream","bg":"#fff1f3","bg2":"#fcefee","gradient":true,"text":"#2b1b20","accent":"#ff7aa2","font":"Playfair Display, serif","animated":true}' style="background:linear-gradient(135deg,#fff1f3,#fcefee);color:#2b1b20">Blush</button>
        <button class="theme-btn" data-theme='{"name":"Lavender Calm","bg":"#f3e8ff","bg2":"#e9f0ff","gradient":true,"text":"#24142f","accent":"#9b7cff","font":"Playfair Display, serif","animated":true}' style="background:linear-gradient(135deg,#f3e8ff,#e9f0ff);color:#24142f">Lavender</button>
        <button class="theme-btn" data-theme='{"name":"Ocean Mist","bg":"#e8fbff","bg2":"#e3f8ff","gradient":true,"text":"#063447","accent":"#00a8cc","font":"Inter, Arial, sans-serif","animated":true}' style="background:linear-gradient(135deg,#e8fbff,#e3f8ff);color:#063447">Ocean</button>
        <!-- Luxury Dark Mode -->
        <button class="theme-btn" data-theme='{"name":"Gold Noir","bg":"#050505","bg2":"#0b0b0b","gradient":false,"text":"#f9f3e6","accent":"#d4af37","font":"Poppins, Inter, Arial, sans-serif","animated":false}' style="background:linear-gradient(135deg,#050505,#0b0b0b)">Gold Noir</button>
        <button class="theme-btn" data-theme='{"name":"Emerald Night","bg":"#041f1b","bg2":"#00332b","gradient":true,"text":"#e6f7f0","accent":"#00b894","font":"Inter, Arial, sans-serif","animated":false}' style="background:linear-gradient(135deg,#041f1b,#00332b)">Emerald</button>
        <button class="theme-btn" data-theme='{"name":"Royal Blue","bg":"#0b1226","bg2":"#122447","gradient":true,"text":"#e6eef8","accent":"#7dd3fc","font":"Inter, Arial, sans-serif","animated":true}' style="background:linear-gradient(135deg,#0b1226,#122447)">Royal</button>
      </div>

      <div style="margin-top:12px">
        <strong>Saved Themes</strong>
        <div class="saved-themes" id="saved-themes"></div>
      </div>
    </div>

    <div class="panel preview" id="live-preview" aria-hidden="false">
      <h3 id="preview-title">Preview</h3>
      <div class="meta" id="preview-meta">Try a preset or tweak the colors & font</div>
      <div style="height:10px"></div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <div style="flex:1;border-radius:8px;padding:8px;background:rgba(0,0,0,0.06)">
          <div style="height:36px;border-radius:6px;background:linear-gradient(90deg, rgba(255,255,255,0.03), transparent);display:flex;align-items:center;justify-content:center">Journal Header</div>
          <div style="height:8px"></div>
          <div style="height:60px;border-radius:6px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)"></div>
        </div>
        <div style="width:60px;border-radius:8px;padding:8px;background:rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:center">Mood</div>
      </div>
    </div>

    <div class="panel" style="width:360px">
      <strong>Tools</strong>
      <div style="margin-top:8px;font-size:13px;opacity:0.85">Quick actions & theme import/export</div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="apply-sample" class="primary">Apply Random Theme</button>
        <button id="clear-storage" class="ghost">Clear Saved Themes</button>
      </div>
      <div style="margin-top:10px;font-size:13px;opacity:0.9">
        Pro tip: Save themes you love ‚Äî they persist in this browser.
      </div>
    </div>
  </aside>
</main>

<div class="footer">Built with ‚ù§Ô∏è ‚Äî Vansima Digital Journal. All settings are stored locally in your browser.</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Helper utilities
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

// Elements
const bgColor = $('#bg-color');
const bgColor2 = $('#bg-color-2');
const useGradient = $('#use-gradient');
const textColor = $('#text-color');
const accentColor = $('#accent-color');
const fontSelect = $('#font-select');
const preview = $('#live-preview');
const previewTitle = $('#preview-title');
const previewMeta = $('#preview-meta');
const saveBtn = $('#save-theme');
const resetBtn = $('#reset-theme');
const savedThemesWrap = $('#saved-themes');
const themeNameInput = $('#theme-name');
const applyRandom = $('#apply-sample');
const clearStorageBtn = $('#clear-storage');
const downloadBtn = $('#download-btn');
const exportBtn = $('#export-theme');
const importBtn = $('#import-theme');

// Journal inputs
const morning = $('#morning');
const goals = $('#goals');
const gratitude = $('#gratitude');
const moods = $$('#mood-tracker button');
const habit1 = $('#habit1'), habit2 = $('#habit2'), habit3 = $('#habit3');

// Default theme
const DEFAULT = {
  name: 'Default Vansima',
  bg: '#111111',
  bg2: '#111111',
  gradient: false,
  text: '#ffffff',
  accent: '#ffcc00',
  font: 'Inter, Arial, sans-serif',
  animated: false
};

// Apply theme object to UI and live preview
function applyTheme(theme, savePreviewMeta=true) {
  const t = Object.assign({}, DEFAULT, theme);
  document.documentElement.style.setProperty('--bg', t.bg);
  document.documentElement.style.setProperty('--surface', t.bg2 === t.bg ? adjustAlpha(t.bg, 0.12) : 'rgba(0,0,0,0.12)');
  document.documentElement.style.setProperty('--text', t.text);
  document.documentElement.style.setProperty('--accent', t.accent);
  document.documentElement.style.setProperty('--font', t.font);
  document.body.style.fontFamily = t.font;

  // background ‚Äî solid or gradient
  if(t.gradient){
    preview.style.background = `linear-gradient(135deg, ${t.bg}, ${t.bg2})`;
    // add subtle animated class when requested
    if(t.animated) preview.classList.add('animated-bg'); else preview.classList.remove('animated-bg');
    if(document.querySelector('.journal')) document.querySelector('.journal').style.background = `linear-gradient(180deg, ${t.bg}, ${t.bg2})`;
  } else {
    preview.style.background = t.bg;
    preview.classList.remove('animated-bg');
    if(document.querySelector('.journal')) document.querySelector('.journal').style.background = t.bg;
  }

  // set CSS vars colors
  document.documentElement.style.setProperty('--bg', t.bg);
  document.documentElement.style.setProperty('--text', t.text);
  document.documentElement.style.setProperty('--accent', t.accent);

  // apply colors to areas
  $$('.section').forEach(s => {
    s.style.background = adjustAlpha(t.bg2 === t.bg ? shadeColor(t.bg, -6) : t.bg2, 0.06);
    s.style.color = t.text;
  });
  $$('.panel').forEach(p => p.style.color = t.text);

  // set inputs to reflect theme
  bgColor.value = t.bg;
  bgColor2.value = t.bg2;
  useGradient.checked = !!t.gradient;
  textColor.value = t.text;
  accentColor.value = t.accent;
  fontSelect.value = t.font;

  // Preview meta
  if(savePreviewMeta){
    previewTitle.textContent = t.name || 'Preview';
    previewMeta.textContent = `Font: ${t.font.split(',')[0].replace(/['"]/g,'')} ‚Ä¢ Accent: ${t.accent} ‚Ä¢ ${t.gradient ? 'Gradient' : 'Solid'}`;
  }
  saveSettingsToStorageUI();
}

// tiny color helpers
function adjustAlpha(hex, alpha) {
  const c = hexToRgb(hex);
  return `rgba(${c.r},${c.g},${c.b},${alpha})`;
}
function hexToRgb(hex) {
  const h = hex.replace('#','');
  return { r: parseInt(h.substring(0,2),16), g: parseInt(h.substring(2,4),16), b: parseInt(h.substring(4,6),16) };
}
function shadeColor(hex, percent) {
  // simple shade
  const num = parseInt(hex.slice(1),16);
  const amt = Math.round(2.55 * percent);
  const R = (num >> 16) + amt;
  const G = (num >> 8 & 0x00FF) + amt;
  const B = (num & 0x0000FF) + amt;
  return '#' + (0x1000000 + (clamp(R,0,255)<<16) + (clamp(G,0,255)<<8) + clamp(B,0,255)).toString(16).slice(1);
}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

// Save/load settings (visual only)
function saveSettingsToStorage() {
  const settings = {
    bg: bgColor.value,
    bg2: bgColor2.value,
    gradient: useGradient.checked,
    text: textColor.value,
    accent: accentColor.value,
    font: fontSelect.value
  };
  localStorage.setItem('journalSettings', JSON.stringify(settings));
}
function saveSettingsToStorageUI(){ // quick small var update for current UI values in localStorage too
  const s = {
    bg: bgColor.value, bg2:bgColor2.value, gradient:useGradient.checked, text:textColor.value, accent:accentColor.value, font:fontSelect.value
  };
  localStorage.setItem('journalSettings', JSON.stringify(s));
}

// Save theme to saved themes list
function getSavedThemes(){ return JSON.parse(localStorage.getItem('savedThemes')||'[]'); }
function renderSavedThemes(){
  const arr = getSavedThemes();
  savedThemesWrap.innerHTML='';
  arr.forEach((t,i)=>{
    const b = document.createElement('button');
    b.className='saved-theme';
    b.textContent = t.name || 'Theme '+(i+1);
    b.title = JSON.stringify(t);
    b.addEventListener('click', ()=> applyTheme(t));
    b.addEventListener('contextmenu', (e)=>{ e.preventDefault(); // right click to delete
      if(confirm('Delete saved theme "'+t.name+'"?')) {
        arr.splice(i,1); localStorage.setItem('savedThemes', JSON.stringify(arr)); renderSavedThemes();
      }
    });
    savedThemesWrap.appendChild(b);
  });
}

// initial load
(function init(){
  // load saved settings for journal inputs
  const saved = JSON.parse(localStorage.getItem('journalData')||'{}');
  morning.value = saved.morning||'';
  goals.value = saved.goals||'';
  gratitude.value = saved.gratitude||'';
  if(saved.mood) {
    moods.forEach(b=>{ if(b.dataset.mood===saved.mood) b.classList.add('selected'); });
  }
  habit1.checked = saved.habits ? saved.habits[0] : false;
  habit2.checked = saved.habits ? saved.habits[1] : false;
  habit3.checked = saved.habits ? saved.habits[2] : false;

  // load saved visual settings
  const s = JSON.parse(localStorage.getItem('journalSettings')||'{}');
  if(Object.keys(s).length) {
    applyTheme({bg:s.bg||DEFAULT.bg, bg2:s.bg2||s.bg, gradient:!!s.gradient, text:s.text||DEFAULT.text, accent:s.accent||DEFAULT.accent, font:s.font||DEFAULT.font, name:'Saved'} , false);
  } else {
    applyTheme(DEFAULT, false);
  }

  // render saved themes
  renderSavedThemes();
})();

// Theme preset buttons
$$('.theme-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    try{
      const theme = JSON.parse(btn.dataset.theme);
      applyTheme(theme);
    }catch(e){ console.error(e) }
  });
});

// Save theme
saveBtn.addEventListener('click', ()=>{
  const name = themeNameInput.value.trim() || prompt('Theme name?','My Theme');
  const theme = {
    name,
    bg: bgColor.value,
    bg2: bgColor2.value,
    gradient: useGradient.checked,
    text: textColor.value,
    accent: accentColor.value,
    font: fontSelect.value,
    animated: preview.classList.contains('animated-bg')
  };
  const arr = getSavedThemes();
  arr.push(theme);
  localStorage.setItem('savedThemes', JSON.stringify(arr));
  renderSavedThemes();
  alert('Theme "'+name+'" saved locally.');
});

// Reset theme to default
resetBtn.addEventListener('click', ()=>{
  if(confirm('Reset to default theme?')) {
    applyTheme(DEFAULT);
    saveSettingsToStorage();
  }
});

// Quick apply random theme
applyRandom.addEventListener('click', ()=>{
  const presets = $$('.theme-btn').map(b=>JSON.parse(b.dataset.theme));
  const pick = presets[Math.floor(Math.random()*presets.length)];
  applyTheme(pick);
});

// Clear saved themes
clearStorageBtn.addEventListener('click', ()=>{
  if(confirm('Remove all saved themes?')) {
    localStorage.removeItem('savedThemes');
    renderSavedThemes();
  }
});

// Inputs change handlers update live preview and save settings
[bgColor,bgColor2,textColor,accentColor,fontSelect,useGradient].forEach(inp=>{
  inp.addEventListener('input', ()=>{
    applyTheme({
      name: themeNameInput.value || 'Custom',
      bg: bgColor.value,
      bg2: bgColor2.value,
      gradient: useGradient.checked,
      text: textColor.value,
      accent: accentColor.value,
      font: fontSelect.value,
      animated: false
    }, true);
    saveSettingsToStorage();
  });
});

// Journal save / load
function saveData() {
  const data = {
    morning: morning.value,
    goals: goals.value,
    gratitude: gratitude.value,
    mood: $$('#mood-tracker button.selected')[0] ? $$('#mood-tracker button.selected')[0].dataset.mood : '',
    habits: [habit1.checked, habit2.checked, habit3.checked]
  };
  localStorage.setItem('journalData', JSON.stringify(data));
}
['input','change'].forEach(ev => {
  [morning,goals,gratitude,habit1,habit2,habit3].forEach(i=>i.addEventListener(ev, saveData));
});

moods.forEach(b=> b.addEventListener('click', ()=>{
  moods.forEach(x=> x.classList.remove('selected'));
  b.classList.add('selected');
  saveData();
}));

// Download snapshot as PDF (simple text snapshot)
downloadBtn.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(14);
  doc.text("Vansima Digital Journal Snapshot", 10, 10);
  doc.setFontSize(11);
  doc.text("Morning Reflection:", 10, 22);
  wrapText(doc, morning.value || "-", 10, 28, 180, 11);
  doc.text("Today's Goals:", 10, doc.lastAutoTable ? doc.lastAutoTable.finalY + 10 : 90);
  wrapText(doc, goals.value || "-", 10, 46, 180, 11);
  doc.text("Gratitude:", 10, 110);
  wrapText(doc, gratitude.value || "-", 10, 116, 180, 11);
  const mood = $$('#mood-tracker button.selected')[0] ? $$('#mood-tracker button.selected')[0].dataset.mood : "-";
  doc.text("Mood: " + mood, 10, 170);
  const habits = ["Drink Water","Exercise","Read"].map((h,i)=> [habit1,habit2,habit3][i].checked ? "‚úì "+h : "‚úó "+h).join(", ");
  doc.text("Habits: " + habits, 10, 178);
  doc.save("Vansima_Digital_Journal_Snapshot.pdf");
});

function wrapText(doc, text, x, y, maxWidth, lineHeight){
  const words = text.split(/\s+/);
  let line = '';
  let curY = y;
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    const width = doc.getTextWidth(testLine);
    if(width > maxWidth && n>0){
      doc.text(line, x, curY);
      line = words[n] + ' ';
      curY += lineHeight;
    } else {
      line = testLine;
    }
  }
  doc.text(line, x, curY);
}

// Export / Import theme JSON
exportBtn.addEventListener('click', ()=>{
  const theme = {
    name: previewTitle.textContent,
    bg: bgColor.value,
    bg2: bgColor2.value,
    gradient: useGradient.checked,
    text: textColor.value,
    accent: accentColor.value,
    font: fontSelect.value
  };
  const blob = new Blob([JSON.stringify(theme, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = (theme.name||'theme') + '.json'; document.body.appendChild(a); a.click();
  a.remove(); URL.revokeObjectURL(url);
});

importBtn.addEventListener('click', ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.addEventListener('change', ()=>{
    const f = input.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload = e => {
      try{
        const t = JSON.parse(e.target.result);
        applyTheme(t);
        alert('Theme imported and applied.');
      }catch(err){ alert('Invalid theme file'); }
    };
    reader.readAsText(f);
  });
  input.click();
});

// Save/load settings to localStorage
function persistVisualSettings(){
  const s = { bg: bgColor.value, bg2: bgColor2.value, gradient: useGradient.checked, text: textColor.value, accent: accentColor.value, font: fontSelect.value };
  localStorage.setItem('journalSettings', JSON.stringify(s));
}
setInterval(persistVisualSettings, 2000);

// Utility to load random preset on first open if no saved settings
if(!localStorage.getItem('journalSettings')) {
  const presets = $$('.theme-btn').map(b=>JSON.parse(b.dataset.theme));
  const pick = presets[Math.floor(Math.random()*presets.length)];
  applyTheme(pick);
}

// Clear all saved themes from storage button
clearStorageBtn.addEventListener('click', ()=>{
  if(confirm('Clear saved themes and journal settings?')){
    localStorage.removeItem('savedThemes');
    localStorage.removeItem('journalSettings');
    renderSavedThemes();
    alert('Cleared saved themes and settings.');
  }
});

// render saved themes once on start
renderSavedThemes();
</script>
</body>
</html>
