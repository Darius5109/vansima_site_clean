<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vansima Checkout</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h2 {
      margin-top: 30px;
      color: #333;
    }

    .payment-options {
      margin-top: 40px;
    }

    .payment-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 28px;
      border-radius: 8px;
      border: 2px solid transparent;
      color: white;
      font-size: 16px;
      font-weight: 500;
      margin: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #apple-pay-button {
      background-color: black;
    }

    #paypal-button {
      background-color: #0070ba;
    }

    #checkout-btn {
      margin-top: 40px;
      padding: 14px 32px;
      background-color: #ff6600;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    #checkout-btn:hover {
      background-color: #e65c00;
    }

    .summary {
      margin-top: 40px;
      font-size: 18px;
      color: #444;
    }
  </style>
</head>
<body>
  <h2>Vansima Checkout</h2>
  <p>Choose your payment method below</p>

  <div class="payment-options">
    <button id="apple-pay-button" class="payment-btn"> Apple Pay</button>
  </div>

  <div class="summary">
    <p id="cart-summary">Loading your cart...</p>
  </div>

  <button id="checkout-btn">Checkout</button>

  <button id="payment-request-button" style="display:none;"></button>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe('pk_live_51SBg7vB48uhmtdR3ddMMaAgdUY9ub9GhQKzMwdvI7AhICGJLcP5jqrrT9qEllE7DD96NPohRCnLa6M3z2sRKxfir00euYSXTZv'); // use your real Stripe *publishable* key (starts with pk_)

  const paymentRequest = stripe.paymentRequest({
    country: 'US',
    currency: 'usd',
    total: { label: 'Vansima Purchase', amount: 1299 }, // example amount in cents
    requestPayerName: true,
    requestPayerEmail: true,
  });

  const elements = stripe.elements();
  const prButton = elements.create('paymentRequestButton', {
    paymentRequest,
  });

  paymentRequest.canMakePayment().then(result => {
    if (result) {
      prButton.mount('#payment-request-button');
      document.getElementById('payment-request-button').style.display = 'block';
    }
  });

  paymentRequest.on('paymentmethod', async ev => {
    const res = await fetch('/create-payment-intent', { method: 'POST' });
    const data = await res.json();
    const confirm = await stripe.confirmCardPayment(data.clientSecret, {
      payment_method: ev.paymentMethod.id,
    }, { handleActions: false });

    if (confirm.error) {
      ev.complete('fail');
    } else {
      ev.complete('success');
      stripe.confirmCardPayment(data.clientSecret);
    }
  });
</script>

<script src="https://www.paypal.com/sdk/js?client-id=AfYroWnxpFm0WuvIyJ4s670ReVWst6MDB22NCWZSEt4F-vHNv4ySZ04kmRA_Mha0Uisw4sN2C7Vzh1hZ"></script>
<div id="paypal-button-container"></div>

<script>
  paypal.Buttons({
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: { value: '12.99' } // replace with your real product price
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Payment completed by ' + details.payer.name.given_name + '!');
      });
    }
  }).render('#paypal-button-container');
</script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const CART_KEY = 'vansima_cart_v1';
      const CHECKOUT_KEY = 'checkout_cart';

      const applePayBtn = document.getElementById('apple-pay-button');
      const paypalBtn = document.getElementById('paypal-button');
      const checkoutBtn = document.getElementById('checkout-btn');
      const summaryText = document.getElementById('cart-summary');

      let selectedPayment = null;

      // Handle payment method selection
      applePayBtn.addEventListener('click', () => {
        selectedPayment = 'Apple Pay';
        alert('You selected Apple Pay');
      });

      paypalBtn.addEventListener('click', () => {
        selectedPayment = 'PayPal';
        alert('You selected PayPal');
      });

      // Load cart data
      const cartData = JSON.parse(localStorage.getItem(CHECKOUT_KEY)) 
                    || JSON.parse(localStorage.getItem(CART_KEY)) 
                    || [];

     let total = 0;
     cartData.forEach(item => {
       const price = parseFloat(item.price.toString().replace(/[^0-9.]/g, '')) || 0;
       const quantity = parseInt(item.quantity || 1); // default to 1 if none saved
       total += price * quantity;
   });

      const totalItems = cartData.reduce((sum, item) => sum + (parseInt(item.quantity || 1)), 0);
      summaryText.textContent = totalItems > 0 
        ? `You have ${totalItems} item(s) in your cart — Total: $${total.toFixed(2)}`
        : 'Your cart is empty!';

      // Checkout button logic
      checkoutBtn.addEventListener('click', () => {
        if (!selectedPayment) {
          alert('Please select a payment method first!');
          return;
        }

        if (cartData.length === 0) {
          alert('Your cart is empty!');
          return;
        }

        alert(`Checkout coming soon!\n\nPayment Method: ${selectedPayment}\nItems in cart: ${cartData.length}\nTotal: $${total.toFixed(2)}`);
      });
    });
  </script>
</body>
</html>